# 虚拟 DOM

虚拟 DOM：一个用来表示真实 DOM 的对象，用对象的属性来描述节点，最少包含标签名、属性、子元素对象三个属性。创建虚拟 DOM 就是为了能更好的将虚拟节点渲染到页面视图中，所以虚拟 DOM 对象的节点与真实 DOM 的属性一一对应。

页面的性能问题大多是由 DOM 操作引起的，真实的 DOM 包含很多属性，频繁的操作还是会出现页面卡顿，引起性能问题。

## Diff 算法

Diff 算法是一种对比算法，对比新旧虚拟 DOM，找出更改的虚拟节点，从而精准的更新真实 DOM 提高效率，新旧`VNode`对比时，深度优先，同层比较。

当数据改变时，触发`setter`，通过`Dep.notify`通知`wacther`（订阅者），`wacther` 调用`patch`方法给真实 DOM 打补丁更新相应的视图。

`patch`函数使用`sameVnode`方法，判断同层虚拟节点是否为同一类标签。如果是，调用`patchVnode`进行深层比对；如果否，则直接替换。

`patchVnode`进行深层比对时，会找到对应的真实 DOM，称为`el`。主要作几个判断

- 新旧都是文本节点且不相等，新文本节点的内容更新到`el`上
- `oldVnode`有子节点而`vnode`没有，则删除`el`子节点
- `oldVnode`没有子节点而`vnode`有，则将`vnode`的子节点真实化后添加到`el`
- 新旧都有子节点，调用`updateChildren`进行比对（首尾指针法，头头、尾尾、头尾、尾头，进行对比查询复用）
