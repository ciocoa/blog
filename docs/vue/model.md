# 双向绑定

单向绑定就是把 model 绑定到 view，当使用 JS 代码更新 model 时，view 就会自动更新。双向绑定就是在单向绑定的基础上，用户更新了 view，model 的数据也会自动更新。

## 原理

双向绑定由三个重要部分构成即 Model、View、ViewModel。ViewModel 是负责连接模型层与视图层的桥梁，其核心功能便是数据双向绑定，数据变化时更新视图，视图变化后更新数据。

ViewModel 有两个主要组成部分：

- 监视器（Observer）：对所有数据属性进行监听
- 解析器（Complier）：对每个元素节点的指令进行扫描与解析，根据指令模版替换数据，绑定相应的更新函数

1. `new vue()`首先执行初始化，对`data`执行响应化处理，这个过程发生在 Observe 中
2. 编译模版，从`data`中找到动态绑定的数据并初始化视图，这个过程发生在 Compile 中
3. 定义一个更新函数和`watcher`，当数据变化时`watcher`会调用更新函数
4. `data`中的某个`key`在一个视图中可能出现多次，所以每个`key`需要一个管家`dep`来管理多个`wacther`
5. `data`中数据一旦发生改变，会先找到对应的`dep`，通知所有`wacther`执行更新函数
